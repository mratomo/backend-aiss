package models

import "time"

// OSInfo contains detailed information about an operating system
type OSInfo struct {
	Type          string `json:"type"`                     // e.g., Windows, Linux, macOS
	Version       string `json:"version"`                  // e.g., 10, Ubuntu 20.04, Monterey 12.3
	Distribution  string `json:"distribution,omitempty"`   // For Linux: Ubuntu, Debian, etc.
	Architecture  string `json:"architecture,omitempty"`   // e.g., x86_64, arm64
	KernelVersion string `json:"kernel_version,omitempty"` // For Unix systems
}

// SoftwareType represents the different types of software
type SoftwareType string

const (
	SoftwareTypeOS          SoftwareType = "os"
	SoftwareTypeApplication SoftwareType = "application"
	SoftwareTypeLibrary     SoftwareType = "library"
	SoftwareTypeFramework   SoftwareType = "framework"
	SoftwareTypeDatabase    SoftwareType = "database"
	SoftwareTypeWebServer   SoftwareType = "web_server"
	SoftwareTypeService     SoftwareType = "service"
	SoftwareTypeContainer   SoftwareType = "container"
	SoftwareTypeOther       SoftwareType = "other"
)

// SoftwareInfo contains information about detected software
type SoftwareInfo struct {
	Name             string                 `json:"name"`
	Version          string                 `json:"version,omitempty"`
	Type             SoftwareType           `json:"type"`
	DetectionMethod  string                 `json:"detection_method,omitempty"`
	DetectionCommand string                 `json:"detection_command,omitempty"`
	Metadata         map[string]interface{} `json:"metadata,omitempty"`
}

// SeverityLevel represents the severity of a vulnerability
type SeverityLevel string

const (
	SeverityHigh          SeverityLevel = "high"
	SeverityMedium        SeverityLevel = "medium"
	SeverityLow           SeverityLevel = "low"
	SeverityInformational SeverityLevel = "informational"
	SeverityUnknown       SeverityLevel = "unknown"
)

// VulnerabilityInfo contains information about a detected vulnerability
type VulnerabilityInfo struct {
	ID                 string        `json:"id"`
	Title              string        `json:"title"`
	Description        string        `json:"description"`
	Severity           SeverityLevel `json:"severity"`
	Confidence         float64       `json:"confidence"` // 0.0-1.0
	AffectedSoftware   string        `json:"affected_software"`
	AffectedVersion    string        `json:"affected_version,omitempty"`
	MitreTechniqueID   string        `json:"mitre_technique_id,omitempty"`
	MitreTechniqueName string        `json:"mitre_technique_name,omitempty"`
	MitreTactic        string        `json:"mitre_tactic,omitempty"`
	Mitigation         string        `json:"mitigation,omitempty"`
	ReferenceURLs      []string      `json:"reference_urls,omitempty"`
	DetectedAt         time.Time     `json:"detected_at"`
}

// VulnerabilitySummary contains a summary of detected vulnerabilities
type VulnerabilitySummary struct {
	HighRisk      int `json:"high_risk"`
	MediumRisk    int `json:"medium_risk"`
	LowRisk       int `json:"low_risk"`
	Informational int `json:"informational"`
	Total         int `json:"total"`
}

// VulnerabilityCheckRequest is the request for vulnerability checking
type VulnerabilityCheckRequest struct {
	SessionID    string         `json:"session_id"`
	OSInfo       OSInfo         `json:"os_info"`
	SoftwareList []SoftwareInfo `json:"software_list"`
}

// VulnerabilityCheckResponse is the response from vulnerability checking
type VulnerabilityCheckResponse struct {
	SessionID       string               `json:"session_id"`
	Vulnerabilities []VulnerabilityInfo  `json:"vulnerabilities"`
	Summary         VulnerabilitySummary `json:"summary"`
	ScanTimestamp   time.Time            `json:"scan_timestamp"`
}

// VulnerabilityAlert represents a vulnerability alert to send to clients
type VulnerabilityAlert struct {
	ID                string        `json:"id"`
	SessionID         string        `json:"session_id"`
	Severity          SeverityLevel `json:"severity"`
	Title             string        `json:"title"`
	Description       string        `json:"description"`
	AffectedItem      string        `json:"affected_item"`
	MitreID           string        `json:"mitre_id,omitempty"`
	RecommendedAction string        `json:"recommended_action,omitempty"`
	Timestamp         time.Time     `json:"timestamp"`
}
